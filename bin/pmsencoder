#!/usr/bin/env perl

use strict;
use warnings;

use App::PMSEncoder;
use Getopt::Long qw(:config posix_default no_ignore_case);

$| = 1; # unbuffer output

my ($status, $test, $pmsencoder, @args);

GetOptions(
    'status' => \$status,
    'test'   => \$test,
) || die "can't process options";

if ($test) {
    @args = qw(
        http://www.youtube.com/watch?v=S3XzUYd6nrU
        -prefer-ipv4
        -nocache
        -quiet
        -oac
        lavc
        -of
        lavf
        -lavfopts
        format=dvd
        -ovc
        lavc
        -lavcopts
        vcodec=mpeg2video:vbitrate=4096:threads=2:acodec=ac3:abitrate=128
        -ofps
        24000/1001
        -o
        deleteme.mpg
    );
} else {
    @args = @ARGV;
}

$pmsencoder = App::PMSEncoder->new({ args => \@args });

if ($status) {
    $pmsencoder->status();
} else {
    $pmsencoder->run();
}
