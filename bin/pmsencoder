#!/usr/bin/env perl

use 5.010000;

use strict;
use warnings;

use App::PMSEncoder;

# FIXME: this still accepts -test &c. Plough through the
# hundreds of alternatives to Getopt::Long to find something that DWIM
use Getopt::Long qw(:config posix_default no_ignore_case);

my $test;
my $pmsencoder = App::PMSEncoder->new();

GetOptions(
    'test:s' => \$test,
    'version' => sub { $pmsencoder->version(); exit 0 },
);

if (defined $test) {
    my @args = $pmsencoder->get_resource('test_args.txt');

    if (length $test) {
        $pmsencoder->fatal('if supplied, the argument to --test must be a valid URI') unless ($test =~ m{^\w+://});
        $args[0] = $test;
    }
    $pmsencoder->argv(\@args);
} else {
    $pmsencoder->argv(\@ARGV);
}

$pmsencoder->run();
